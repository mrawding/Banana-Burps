<!DOCTYPE html>
<html>
  <head>
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  </head>
  <body>
    <h1>Welcome to Banana Burps</h1>
    <h2> Score: </h2>
    <span id = "score">
    </span>
    <span id="timer">Time:
    <span id="time">60</span>
      
    </span>
    <span id = "word"></span>
    <button id="start">Start</button>
        <span id="bingos">
        </span>
    <span id = "highscore">Highscore: </span>
      <br>
      <input type="text" id="entry" />
      <button id="enter">Enter</button>
      </br>
        
  </body>
  <script>
    
    $(document).ready(function(){
    var score = 0.0;
    var game_start = false;
    var updated_hs = false;
    var counter = 60.0;
     $("#start").on("click", function(){
    //    $.ajax({
      //      method: "GET",
        //    url: "api.php",
          //  success: data=> words
          //});
        
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
           window.words = JSON.parse(this.responseText);
          // this is where rack should be.
           document.getElementById("bingos").innerHTML = window.words[window.words.length - 1];
          }
        };
        xmlhttp.open("GET", "api.php", true);
        xmlhttp.send(); 
        var xmlhttp1 = new XMLHttpRequest();
        
        xmlhttp1.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
           document.getElementById("highscore").innerHTML = JSON.parse(this.responseText);
          startGame();

          }
        };
        xmlhttp1.open("POST", "fetch.php",true);
        xmlhttp1.setRequestHeader("Content-Type", "application/json");
        xmlhttp1.send(JSON.stringify({"score": score})); 
        //startGame();
        });
     let updateHighScore = function()
     {
  
       //var php_obj = JSON.stringify(score);
          var xmlhttp1 = new XMLHttpRequest();
        
         xmlhttp1.onreadystatechange = function() {
         if (this.readyState == 4 && this.status == 200) {
           if(score > document.getElementById("highscore")){
           document.getElementById("highscore").innerHTML = score;
           }
         
          }
        };
        xmlhttp1.open("POST", "fetch.php",true);
        xmlhttp1.setRequestHeader("Content-Type", "application/json");
        xmlhttp1.send(JSON.stringify({"score":score})); 
     }
    
     let startGame = function(){
        updated_hs = false;
        counter = 60.0;
        score = 0;
        updateScore(score);
       game_start = true;
        var interval = setInterval(function() {
        counter -= 0.1;
        if (counter < 0) {
          if(!updated_hs){
            updateHighScore();
            updated_hs = true;
           // location.reload(false);
          }
         
          return;
        }
          
        else{
           $('#time').text(counter.toFixed(1));
          $("#enter").on("click", function(){
        	findMatch();
          });
        }
        },100); 
         }
        
     let findMatch = function(){
         var i;
          var input = document.getElementById('entry').value;
          var inp_text = String(input);
          for(i =0;i<window.words.length;i++){
              var j;
              for(j = 0;j < window.words[i].length; j++){
                if(window.words[i][j] == inp_text.toUpperCase()){
                  score += (input.length)*100;
                  document.getElementById('entry').value = "";
                  updateScore(score);
                  return true;
                }
              }
          }      
         
         
      }
      let updateScore = function(score){
         document.getElementById('score').innerHTML = "";
        document.getElementById('score').innerHTML = score;
      }
        
      
        //  
     
    });
     
  </script>
</html>
